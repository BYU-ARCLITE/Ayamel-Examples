@(content: models.Content, course: Course, resourceLibraryUrl: String)

@isChecked(val1: Any, val2: Any) = {
    @if(val1 == val2) {
        checked
    }
}

@coursePrefix = @{"course_" + course.id.get + ":"}

@level = @{
    val l = content.settings.get(coursePrefix + "level").getOrElse("1")
    if (l.isEmpty)
        "1"
    else
        l
}

<form id="courseSettingsForm" class="form-horizontal" method="post" action="@routes.ContentController.setCourseSettings(content.id.get, course.id.get)">
    <input type="hidden" name="contentType" value="video">
    <div class="control-group">
        <label class="control-label" for="playbackLevel">Playback level</label>
        <div class="controls">

            <label class="radio">
                <input type="radio" name="level" value="1" @isChecked(level, "1")>
                    1 - Video playback
            </label>

            @if(content.level.toInt >= 2) {
                <label class="radio">
                    <input type="radio" name="level" value="2" @isChecked(level, "2")>
                        2 - Video playback and subtitles
                </label>
            }
            @if(content.level.toInt >= 3) {
                <label class="radio">
                    <input type="radio" name="level" value="3" @isChecked(level, "3")>
                        3 - Video, subtitles, and interactions
                </label>
            }
            @if(content.level.toInt >= 4) {
                <label class="radio">
                    <input type="radio" name="level" value="4" @isChecked(level, "4")>
                        4 - Video, subtitles, interactions, and annotations
                </label>
            }
            @if(content.level.toInt >= 5) {
                <label class="radio">
                    <input type="radio" name="level" value="5" @isChecked(level, "5")>
                        5 - Video, subtitles, interactions, annotations, and auto-generated activities
                </label>
            }
        </div>

        <div class="control-group">
            <label class="control-label" for="courseCaptionTracks">Enabled Caption Tracks</label>
            <div class="controls">
                <select multiple="multiple" name="captionTracks" id="courseCaptionTracks">
                </select>
            </div>
        </div>

        <div class="control-group">
            <label class="control-label" for="courseAnnotationDocs">Enabled Annotations</label>
            <div class="controls">
                <select multiple="multiple" name="annotationDocs" id="courseAnnotationDocs">
                </select>
            </div>
        </div>
    </div>
    <input type="submit" style="position: absolute; left: -9999px; width: 1px; height: 1px;"/>
</form>

<script type="text/javascript">
    $(function() {
        var content = @Html(content.toJson.toString());
        var url = "@resourceLibraryUrl/@content.resourceId";
        var coursePrefix = "course_@{course.id.get}:";

        var allowedCaptionTracks = [];
        if (content.settings.enabledCaptionTracks) {
            allowedCaptionTracks = content.settings.enabledCaptionTracks.split(",");
        }

        var allowedAnnotationDocs = [];
        if (content.settings.enabledAnnotationDocuments) {
            allowedAnnotationDocs = content.settings.enabledAnnotationDocuments.split(",");
        }

        var captionTracks = [];
        if (content.settings[coursePrefix + "enabledCaptionTracks"]) {
            captionTracks = content.settings[coursePrefix + "enabledCaptionTracks"].split(",");
        }

        var annotationDocs = [];
        if (content.settings[coursePrefix + "enabledAnnotationDocuments"]) {
            annotationDocs = content.settings[coursePrefix + "enabledAnnotationDocuments"].split(",");
        }

        ResourceLibrary.load(url, function(resource) {
            // Load the transcripts (caption tracks)
            resource.getTranscripts(function (transcripts) {
                var $captionTracks = $("#courseCaptionTracks");
                transcripts.forEach(function(transcript) {
                    if (allowedCaptionTracks.indexOf(transcript.id) >= 0) {
                        var html = '<option value="' + transcript.id + '">' + transcript.title + ' (' + transcript.language + ')</option>';
                        $captionTracks.append(html);
                    }
                });
                $captionTracks.val(captionTracks);
            });

            // Load the annotations
            resource.getAnnotations(function (annotations) {
                var $annotationDocs = $("#courseAnnotationDocs");
                annotations.forEach(function(annotationDoc) {
                    if (allowedAnnotationDocs.indexOf(annotationDoc.id) >= 0) {
                        var html = '<option value="' + annotationDoc.id + '">' + annotationDoc.title + '</option>';
                        $annotationDocs.append(html);
                    }
                });
                $annotationDocs.val(annotationDocs);
            });
        });
    });
</script>