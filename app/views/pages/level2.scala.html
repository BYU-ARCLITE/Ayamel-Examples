@(movie: Movie)(implicit request: RequestHeader, user: User)

@main("Ayamel Examples - Level 2") {

    <!-- Include the Ayamel css files -->
    <link rel="stylesheet" media="screen" href="@routes.Assets.at("stylesheets/controlBar.css")">
    <link rel="stylesheet" media="screen" href="@routes.Assets.at("stylesheets/stage.css")">

    <!-- Resource Library Scripts -->
    <script src="@routes.Assets.at("javascripts/resources.js")" type="text/javascript"></script>

    <!-- Ayamel scripts -->
    <script src="@routes.Assets.at("javascripts/Ayamel.js/Ayamel.js")" type="text/javascript"></script>
    <script src="@routes.Assets.at("javascripts/Ayamel.js/h5clip.js")" type="text/javascript"></script>
    <script src="@routes.Assets.at("javascripts/Ayamel.js/MediaController.js")" type="text/javascript"></script>
    <script src="@routes.Assets.at("javascripts/Ayamel.js/MediaControls.js")" type="text/javascript"></script>
    <script src="@routes.Assets.at("javascripts/Ayamel.js/TimedMedia.js")" type="text/javascript"></script>
    <script src="@routes.Assets.at("javascripts/Ayamel.js/UniformAspectRatio.js")" type="text/javascript"></script>
    <script src="@routes.Assets.at("javascripts/Ayamel.js/video.js")" type="text/javascript"></script>
    <script src="@routes.Assets.at("javascripts/Ayamel.js/VideoPlayer.js")" type="text/javascript"></script>

    <!-- Caption Renderer script -->
    <script src="@routes.Assets.at("javascripts/Caption-Renderer/caption-renderer.js")" type="text/javascript"></script>

    <!-- Timed Text scripts -->
    <script src="@routes.Assets.at("javascripts/TimedText/TimedText.js")" type="text/javascript"></script>
    <script src="@routes.Assets.at("javascripts/TimedText/TextTrack.js")" type="text/javascript"></script>
    <script src="@routes.Assets.at("javascripts/TimedText/TextTrackCue.js")" type="text/javascript"></script>
    <script src="@routes.Assets.at("javascripts/TimedText/WebVTT.js")" type="text/javascript"></script>

    <div class="container">

        @views.html.application.navbar("watch")

        <h1>@movie.name</h1>
        <h1><small>Level 2</small></h1>

        <div id="stage" class="aspect_container">
            <div id="player"></div>
            <div id="captions" style="position: absolute; top: 0; left: 0;"></div>
        </div>

        <script type="text/javascript">

            var movie = @Html(movie.toJson.toString()),
                renderer;

            $(function() {
                // Load the resource
                new Resource(movie.resourceId, function(resource) {
                    // Install the html5 video player
                    Ayamel.AddVideoPlayer(h5PlayerInstall, 1, function() {
                        var player = $('#player').get(0);

                        // Create the player
                        var videoPlayer = new Ayamel.VideoPlayer({
                            element: player,
                            aspectRatio: 45,
                            resource: resource
                        });

                        // Create the caption renderer
                        var video = $("#player").find("video").get(0);
                        var captions = $("#captions").get(0);
                        renderer = new CaptionRenderer(video, {
                            appendCueCanvasTo: captions,
                            styleCue: function(DOMNode, track){
                                return DOMNode;
                            }
                        });
                        renderer.bindMediaElement(video);

                        // Add the first caption track
                        var captionTrack = movie.captionTracks[0];

                        // Get the resource
                        new Resource(captionTrack.resourceId, function(resource) {
                            TextTrack.get({
                                kind: "subtitles",
                                label: captionTrack.name,
                                lang: captionTrack.language,
                                url: resource.content.files[0].downloadUri,
                                success: function(){
                                    var track = this;
                                    track.mode = 'showing';
                                    renderer.addTextTrack(track);
                                }
                            });
                        });

                    });
                });
            });
        </script>

    </div>

}
